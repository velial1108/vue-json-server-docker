name: Deploy Vue App to GitHub Pages

on:
  push:
    branches: [ main, master ]

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4

      - name: ‚éî Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'
          cache: 'npm'

      - name: üì¶ Install dependencies
        run: npm ci

      - name: üèóÔ∏è Build application
        run: |
          # –°–æ–∑–¥–∞—ë–º .env.production –¥–ª—è GitHub Pages (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ö–æ—Å—Ç–∏–Ω–≥ ‚Üí –º–æ–∫–∏)
          echo "VITE_API_BASE_URL=/" > .env.production
          echo "VITE_APP_TITLE=Vue Composition API App" >> .env.production
          
          # –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
          npm run build
          echo "‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω–æ!"

      - name: üîç Verify build output
        run: |
          echo "=== PROJECT STRUCTURE ==="
          ls -la
          echo "=== DIST CONTENTS (HTML/JS/CSS) ==="
          find dist/ -type f \( -name "*.html" -o -name "*.js" -o -name "*.css" \) | head -20
          echo "=== ASSETS IN index.html ==="
          grep -oE '(src|href)="[^"]*"' dist/index.html || echo "‚ö†Ô∏è No assets found in index.html"

      - name: üìÅ Upload to GitHub Pages
        uses: actions/upload-pages-artifact@v3
        with:
          path: dist/

      - name: üöÄ Deploy to GitHub Pages
        uses: actions/deploy-pages@v4

      - name: ‚úÖ Deployment info
        run: |
          echo "üéâ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ!"
          echo "üîó URL: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/"
          echo "üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ù–∞ GitHub Pages –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–æ–∫-–¥–∞–Ω–Ω—ã–µ (–Ω–µ—Ç –±—ç–∫–µ–Ω–¥–∞)."
